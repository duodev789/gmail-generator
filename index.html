<!DOCTYPE html>
<html>
<head>
    <title>Random Email + Permanent Inbox + Search Inbox</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f2f2f2; }
        .box { background: #fff; padding: 20px; border-radius: 10px; width: 500px; margin: auto; }
        button {
            padding: 10px 15px; background: #007bff; color: white;
            border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;
        }
        #emailBox, #searchBox { 
            background: #eee; padding: 10px; border-radius: 5px; margin-top: 10px; 
        }
        input {
            width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;
            margin-top: 10px;
        }
        .mail {
            background: #ddd; padding: 10px; margin: 10px 0;
            border-radius: 5px; cursor: pointer;
        }
        pre { background: black; color: #0f0; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="box">
    <h2>Random Email Generator + Permanent Inbox + Load By Email</h2>

    <button onclick="generateEmail()">Generate New Email</button>
    <button onclick="loadSavedEmail()">Load Saved Inbox</button>

    <div id="emailBox"></div>

    <h3>Load Inbox by Email Address:</h3>
    <input id="searchEmail" placeholder="Enter temp email (ex: user123@mail.tm)">
    <button onclick="loadByEmail()">Load Inbox</button>

    <div id="searchBox"></div>

    <h3>Inbox:</h3>
    <div id="inbox"></div>

    <h3>Mail Content:</h3>
    <pre id="mailContent"></pre>
</div>

<script>
let currentEmail = "";
let emailLogin = "";

// Save email + token for future use
function saveEmail() {
    localStorage.setItem("saved_email", currentEmail);
    localStorage.setItem("saved_token", emailLogin);
}

// Load saved email anytime
function loadSavedEmail() {
    const savedEmail = localStorage.getItem("saved_email");
    const savedToken = localStorage.getItem("saved_token");

    if (!savedEmail || !savedToken) {
        alert("No saved email found!");
        return;
    }

    currentEmail = savedEmail;
    emailLogin = savedToken;

    document.getElementById("emailBox").innerHTML =
        "<b>Saved Email Loaded:</b> " + currentEmail;

    loadInbox();
    setInterval(loadInbox, 5000);
}

// Generate random email
async function generateEmail() {
    const res = await fetch("https://api.mail.tm/domains");
    const data = await res.json();
    const domain = data["hydra:member"][0].domain;

    const randomName = "user" + Math.floor(Math.random() * 999999);
    currentEmail = randomName + "@" + domain;

    document.getElementById("emailBox").innerHTML =
        "<b>Your Email:</b> " + currentEmail;

    await fetch("https://api.mail.tm/accounts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: currentEmail, password: "123456" })
    });

    const loginRes = await fetch("https://api.mail.tm/token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: currentEmail, password: "123456" })
    });

    const loginData = await loginRes.json();
    emailLogin = loginData.token;

    saveEmail();
    loadInbox();
    setInterval(loadInbox, 5000);
}

// Load inbox normally
async function loadInbox() {
    if (!emailLogin) return;

    const inboxRes = await fetch("https://api.mail.tm/messages", {
        headers: { Authorization: "Bearer " + emailLogin }
    });

    const inboxData = await inboxRes.json();
    const inboxDiv = document.getElementById("inbox");
    inboxDiv.innerHTML = "";

    inboxData["hydra:member"].forEach(mail => {
        const div = document.createElement("div");
        div.className = "mail";
        div.innerHTML = "<b>" + mail.subject + "</b><br>" + mail.from.address;
        div.onclick = () => readMail(mail.id);
        inboxDiv.appendChild(div);
    });
}

// Read single mail
async function readMail(mailId) {
    const mailRes = await fetch("https://api.mail.tm/messages/" + mailId, {
        headers: { Authorization: "Bearer " + emailLogin }
    });

    const mail = await mailRes.json();
    document.getElementById("mailContent").textContent =
        mail.text || mail.html || "No Content";
}

// NEW FEATURE â€” Load inbox by entering email
async function loadByEmail() {
    const email = document.getElementById("searchEmail").value;

    if (!email || !email.includes("@")) {
        alert("Enter valid temp email!");
        return;
    }

    // Try login with default password
    const loginRes = await fetch("https://api.mail.tm/token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address: email, password: "123456" })
    });

    const loginData = await loginRes.json();

    if (!loginData.token) {
        alert("Email not found OR wrong password!");
        return;
    }

    emailLogin = loginData.token;
    currentEmail = email;

    document.getElementById("searchBox").innerHTML =
        "<b>Loaded Inbox of:</b> " + email;

    loadInbox();
    setInterval(loadInbox, 5000);
}
</script>

</body>
</html>
